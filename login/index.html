


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Login - TreeHacks Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b9ffd7b.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b79bcd20.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=-apple-system,+system-ui,+BlinkMacSystemFont,+'Segoe+UI',+Roboto,+'Helvetica+Neue',+Ubuntu,+Arial,+sans-serif:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Ubuntu, Arial, sans-serif",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../main.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="blue-grey">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#access-control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="TreeHacks Developer Documentation" class="md-header-nav__button md-logo" aria-label="TreeHacks Developer Documentation">
      
  <img src="../img/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            TreeHacks Developer Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Login
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/TreeHacks/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TreeHacks/docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TreeHacks Developer Documentation" class="md-nav__button md-logo" aria-label="TreeHacks Developer Documentation">
      
  <img src="../img/logo.svg" alt="logo">

    </a>
    TreeHacks Developer Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/TreeHacks/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TreeHacks/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Root
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Root" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Root
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../root/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../root/theming/" title="Theming" class="md-nav__link">
      Theming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../root/application-portal/" title="Application Portal" class="md-nav__link">
      Application Portal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../root/admin-portal/" title="Admin Portal" class="md-nav__link">
      Admin Portal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../root/sponsor-portal/" title="Sponsor Portal" class="md-nav__link">
      Sponsor Portal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Login
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Login" class="md-nav__link md-nav__link--active">
      Login
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    Access control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stanford-login" class="md-nav__link">
    Stanford login
  </a>
  
    <nav class="md-nav" aria-label="Stanford login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spdb-configuration" class="md-nav__link">
    SPDB configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renewing-spdb-config" class="md-nav__link">
    Renewing SPDB config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-cognito-user-pool" class="md-nav__link">
    Setting up a Cognito user pool
  </a>
  
    <nav class="md-nav" aria-label="Setting up a Cognito user pool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-stanford-login-with-cognito" class="md-nav__link">
    Setting up Stanford login with Cognito
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../meet/" title="Meet" class="md-nav__link">
      Meet
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cog/" title="Cog" class="md-nav__link">
      Cog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gavel/" title="Gavel" class="md-nav__link">
      Gavel
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../submit/" title="Submit" class="md-nav__link">
      Submit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      DevOps
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="DevOps" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/dns/" title="DNS" class="md-nav__link">
      DNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/aws-inventory/" title="AWS Inventory" class="md-nav__link">
      AWS Inventory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/domain-inventory/" title="Domain Inventory" class="md-nav__link">
      Domain Inventory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/account-inventory/" title="Account Inventory" class="md-nav__link">
      Account Inventory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/g-suite/" title="G Suite" class="md-nav__link">
      G Suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/next-year/" title="Preparing for the next year" class="md-nav__link">
      Preparing for the next year
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    Access control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stanford-login" class="md-nav__link">
    Stanford login
  </a>
  
    <nav class="md-nav" aria-label="Stanford login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spdb-configuration" class="md-nav__link">
    SPDB configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renewing-spdb-config" class="md-nav__link">
    Renewing SPDB config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-cognito-user-pool" class="md-nav__link">
    Setting up a Cognito user pool
  </a>
  
    <nav class="md-nav" aria-label="Setting up a Cognito user pool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-stanford-login-with-cognito" class="md-nav__link">
    Setting up Stanford login with Cognito
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/TreeHacks/docs/edit/master/docs/login.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>Login</h1>
                
                <p>The login system is an SSO system that is used on all our sites. We use Cognito user pools for login, which allows people with non-@stanford.edu emails to create a username and password to sign in, while people with @stanford.edu emails can click "Log in with Stanford."</p>
<h2 id="access-control">Access control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h2>
<p>Access control is done by using <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-user-groups.html">Cognito groups</a>. We have the following groups:</p>
<table>
<thead>
<tr>
<th>Group Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin</td>
<td>Access to everything, all application data (only a few people, codirectors, tech should have this role)</td>
</tr>
<tr>
<td>reviewer</td>
<td>Access to review all applications on root (generally the whole TreeHacks team should have this role)</td>
</tr>
<tr>
<td>mentor</td>
<td>Access to be a mentor on help.treehacks.com (all mentors, when signing up with the special mentor link, are assigned this role)</td>
</tr>
<tr>
<td>sponsor</td>
<td>Access to Sponsor Portal (all sponsors, when created, are assigned this role)</td>
</tr>
<tr>
<td>judge</td>
<td>Judge access to Root (no longer used, todo delete this)</td>
</tr>
</tbody>
</table>
<h2 id="stanford-login">Stanford login<a class="headerlink" href="#stanford-login" title="Permanent link">&para;</a></h2>
<p>We use Stanford login, which integrates with our Cognito user pools. To do so, we have registered entries in SPDB, which is Stanford's database of which services are allowed to log in with Stanford.</p>
<h3 id="spdb-configuration">SPDB configuration<a class="headerlink" href="#spdb-configuration" title="Permanent link">&para;</a></h3>
<p>We have the following configs set up in SPDB:</p>
<p><a href="https://spdb.stanford.edu/spconfigs/4720">urn:amazon:cognito:sp:us-east-1_dvGgSVQIh</a> - connects with the treehacks-prod Cognito user pool</p>
<p><a href="https://spdb.stanford.edu/spconfigs/4622">urn:amazon:cognito:sp:us-east-1_zraMJaf9F</a> - connects with the treehacks-dev Cognito user pool</p>
<h3 id="renewing-spdb-config">Renewing SPDB config<a class="headerlink" href="#renewing-spdb-config" title="Permanent link">&para;</a></h3>
<p>Every year, sometime before September, you will receive an email that looks like the following:</p>
<p><img alt="saml email" src="../img/saml%20email.png" /></p>
<p>This means that you need to renew the SPDB configuration for both dev and prod. Please open a <a href="https://stanford.service-now.com/services/">ServiceNow Ticket</a> with Stanford with a message such as following:</p>
<blockquote>
<p>We would like to renew the following SPDB configs used for TreeHacks: https://spdb.stanford.edu/spconfigs/4720 and https://spdb.stanford.edu/spconfigs/4622.</p>
</blockquote>
<h2 id="setting-up-a-cognito-user-pool">Setting up a Cognito user pool<a class="headerlink" href="#setting-up-a-cognito-user-pool" title="Permanent link">&para;</a></h2>
<p>Here are steps to follow if you are creating a new Cognito user pool from scratch for root. You may not need to do this regularly, as you can just reuse existing user pools each year, but these steps are documented in case they are needed:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps could also apply for integrating <em>any</em> Cognito user pool with Stanford login, for non-TreeHacks-specific applications.</p>
</div>
<ul>
<li>
<p>When the pool is created, make sure you create it with the "Email address or phone number" option (rather than "username" option).</p>
</li>
<li>
<p>Note down the pool id of your user pool. Set the <code>COGNITO_USER_POOL_ID</code> environment variable on login.treehacks.com equal to this value.
<img alt="pool id" src="../img/pool%20id.png" /></p>
</li>
<li>
<p>Under "Message customizations", make sure that emails are sent through Amazon SES and "verification type" is set to "Code".
<img alt="cognito ses" src="../img/cognito%20ses.png" /></p>
</li>
<li>
<p>Create a new lambda function with the contents of <a href="https://github.com/TreeHacks/root/blob/master/util/conf_email_lambda.js">root/util/conf_email_lambda.js</a>. Make sure to set the <code>COGNITO_USER_POOL_ID</code> and <code>WEBSITE</code> environment variables of this lambda function. Then, go to "Triggers" and select this lambda function as the "Custom message" trigger.
<img alt="cognito triggers" src="../img/cognito%20triggers.png" /></p>
</li>
<li>
<p>Create a new app client. Make sure the settings are similar to the ones in the screenshot below. Note down the "app client id" value and set the <code>COGNITO_CLIENT_ID</code> environment variable on login.treehacks.com to be equal to this value.
<img alt="cognito app client" src="../img/cognito%20app%20client.png" /></p>
</li>
<li>
<p>Under "App client settings", make sure that both "Stanford" and "Cognito User Pool" are selected identity providers, and the below OAuth 2.0 settings are set. You also want to set the callback / sign out URLs as below. Include <code>localhost:9000</code> if you have a dev user pool; otherwise, don't include the localhost URL.
<img alt="cognito app client settings" src="../img/cognito%20app%20client%20settings.png" /></p>
</li>
</ul>
<h3 id="setting-up-stanford-login-with-cognito">Setting up Stanford login with Cognito<a class="headerlink" href="#setting-up-stanford-login-with-cognito" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Set a domain name for your user pool. Note this value down (in this case it's "https://treehacks-prod.auth.us-east-1.amazoncognito.com"). You should set the <code>COGNITO_ENDPOINT_URL</code> environment variable on login.treehacks.com to be equal to this value:
<img alt="cognito domain name" src="../img/cognito%20domain%20name.png" /></p>
</li>
<li>
<p>Create a new SAML identity provider named "Stanford". Set the value of the "Metadata" document to "https://idp.stanford.edu/metadata.xml" and click "Create provider".
<img alt="stanford idp" src="../img/stanford%20idp.png" /></p>
</li>
<li>
<p>Click "Show signing certificate" for the Stanford identity provider and save the contents of a textbox to a safe place.
<img alt="signing certificate" src="../img/signing%20cert.png" /></p>
</li>
<li>
<p>Go to "Attribute mapping" and map the SAML attribute "urn:oid:1.3.6.1.4.1.5923.1.1.1.6" to the user pool attributes "Name" and "Email". (That number comes from <a href="https://uit.stanford.edu/service/saml/arp">this link</a> -- it corresponds to <code>eduPersonPrincipalName</code>)
<img alt="attribute mapping" src="../img/attribute%20mapping.png" /></p>
</li>
<li>
<p>Now, we have to apply for an exception with Stanford because Cognito does not support encrypted SAML assertions. This involves (see <a href="https://uit.stanford.edu/service/saml/exception">this page</a> for Stanford's description of the exception process):</p>
</li>
<li>
<p>Create a ServiceNow Ticket with language such as the following:</p>
</li>
</ul>
<blockquote>
<p>The entityID of the Service Provider - urn:amazon:cognito:sp:us-east-1_he6sIPQW9 (fill this in with the right entityID, replacing the "us-east-1_he6sIPQW9" part with the right user pool ID)</p>
<p>Contact information for the Service Provider's technical support - [name], [email]</p>
<p>Reason why the Service Provider cannot support encrypted responses - Amazon Cognito does not supported encrypted responses</p>
<p>Number of people at Stanford who will be using application - thousands</p>
<p>Purpose of the application - Stanford signin for TreeHacks applicants</p>
<p>Name and email of the Service Provider's Stanford technical contact - [name], [email]</p>
<p>Name and email of the manager of the Stanford team responsible for this application - [name], [email]</p>
</blockquote>
<ul>
<li>Send an e-mail (ideally, it should be the TreeHacks faculty sponsor who sends the email, but you might also be able to send it) to saml-team@lists.stanford.edu agreeing to this text:</li>
</ul>
<blockquote>
<p>We are aware that by not encrypting the Identity Provider's SAML response there is an increased risk both of exposing the response's data and future security issues exploiting the unencrypted response, and that we accept this increased risk.</p>
</blockquote>
<ul>
<li>Create another <a href="https://stanford.service-now.com/services/">ServiceNow Ticket</a> with the following language:</li>
</ul>
<blockquote>
<p>We'd like to integrate SAML login with an Amazon Cognito user pool for TreeHacks. Cognito does not support encrypted SAML assertions, so I would like to request an exception. I have already completed the steps outlined in https://uit.stanford.edu/service/saml/exception. I have attached the SAML metadata (metadata.xml) and signing certificate (cert.txt) for my SP. Could you please help upload this configuration to SPDB?</p>
<p>Additionally, AWS Cognito user pools do not work with the default NameID parameter. Can you set the Subject to <sunetid>@stanford.edu change the configuration to release eduPersonPrincipalName as NameID?</p>
</blockquote>
<p>The following files should be attached to the above ticket:</p>
<ul>
<li>metadata.xml (make sure you change the <code>validUntil</code> attribute to a year from now, replace the last part of <code>entityID</code> with the user pool ID, replace <code>https://treehacks-prod.auth.us-east-1.amazoncognito.com</code> with your user pool's domain name, and replace the contact name / email addresses for technical and support contacts):</li>
</ul>
<div class="codehilite"><pre><span></span><code>  <span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;</span> <span class="na">validUntil=</span><span class="s">&quot;2021-02-27T20:58:21Z&quot;</span> <span class="na">cacheDuration=</span><span class="s">&quot;PT604800S&quot;</span> <span class="na">entityID=</span><span class="s">&quot;urn:amazon:cognito:sp:us-east-1_OzykbuXao&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;md:SPSSODescriptor</span> <span class="na">AuthnRequestsSigned=</span><span class="s">&quot;false&quot;</span> <span class="na">WantAssertionsSigned=</span><span class="s">&quot;false&quot;</span> <span class="na">protocolSupportEnumeration=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;md:NameIDFormat&gt;</span>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified<span class="nt">&lt;/md:NameIDFormat&gt;</span>
      <span class="nt">&lt;md:AssertionConsumerService</span> <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span> <span class="na">Location=</span><span class="s">&quot;https://treehacks-prod.auth.us-east-1.amazoncognito.com/saml2/idpresponse&quot;</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/md:SPSSODescriptor&gt;</span>
    <span class="nt">&lt;md:ContactPerson</span> <span class="na">contactType=</span><span class="s">&quot;technical&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;md:GivenName&gt;</span>Ashwin Ramaswami<span class="nt">&lt;/md:GivenName&gt;</span>
      <span class="nt">&lt;md:EmailAddress&gt;</span>xxx@stanford.edu<span class="nt">&lt;/md:EmailAddress&gt;</span>
    <span class="nt">&lt;/md:ContactPerson&gt;</span>
    <span class="nt">&lt;md:ContactPerson</span> <span class="na">contactType=</span><span class="s">&quot;support&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;md:GivenName&gt;</span>Ashwin Ramaswami<span class="nt">&lt;/md:GivenName&gt;</span>
      <span class="nt">&lt;md:EmailAddress&gt;</span>xxx@stanford.edu<span class="nt">&lt;/md:EmailAddress&gt;</span>
    <span class="nt">&lt;/md:ContactPerson&gt;</span>
  <span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</code></pre></div>


<ul>
<li>
<p>cert.txt (put the contents of the user pool signing certificate into this text file)</p>
</li>
<li>
<p>Wait and see! Hopefully the Stanford support representative will help you through the process if there are any issues -- eventually, they will create a SPDB config entry and Stanford login should work.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might get an error when using Stanford login such as the following: <code>Error in SAML response processing: 1 validation error detected: Value 'stanford_.....' at 'userName' failed to satisfy constraint: Member must have length less than or equal to 128</code>. If this happens, please underscore the second point in the original support ticket (ask the representative to make sure they have set the Subject to <code>&lt;sunetid&gt;@stanford.edu</code> and released eduPersonPrincipalName as NameID).</p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../root/sponsor-portal/" title="Sponsor Portal" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sponsor Portal
              </div>
            </div>
          </a>
        
        
          <a href="../meet/" title="Meet" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Meet
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>